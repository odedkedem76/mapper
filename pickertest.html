<!DOCTYPE html>
<html>
<head>
    <title>Access Your Google Drive</title>
    <meta charset="utf-8" />
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background-color: #357abd;
        }
    </style>
</head>
<body>
    <h1>Access Your Google Drive</h1>
    
    <div id="signin-container">
        <div id="g_id_onload"
             data-auto_select="false"
             data-skip_prompt_cookie="false"
             data-context="signin"
             data-ux_mode="popup"
             data-callback="handleCredentialResponse">
        </div>

        <div class="g_id_signin"
             data-type="standard"
             data-size="large"
             data-theme="outline"
             data-text="signin"
             data-shape="rectangular"
             data-logo_alignment="left">
        </div>
    </div>

    <script>
        function loadGoogleDrivePicker() {
            // This will open Google's file picker interface
            const openPicker = () => {
                // Use Google's built-in picker
                google.load('picker', '1', {
                    callback: () => {
                        const picker = new google.picker.PickerBuilder()
                            .addView(google.picker.ViewId.DOCS)
                            .setOAuthToken(window.accessToken)
                            .setDeveloperKey(null)  // No developer key needed
                            .setCallback(pickerCallback)
                            .build();
                        picker.setVisible(true);
                    }
                });
            };

            // Load the picker API
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js?onload=onApiLoad';
            document.body.appendChild(script);
        }

        function pickerCallback(data) {
            if (data.action === google.picker.Action.PICKED) {
                const fileId = data.docs[0].id;
                downloadFile(fileId, data.docs[0].name);
            }
        }

        function handleCredentialResponse(response) {
            // Handle the Google Sign-In response
            window.accessToken = response.credential;
            loadGoogleDrivePicker();
        }

        async function downloadFile(fileId, fileName) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
                    {
                        headers: {
                            'Authorization': `Bearer ${window.accessToken}`
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (error) {
                console.error('Error downloading file:', error);
                alert('Error downloading the file. Please try again.');
            }
        }
    </script>
    <script src="https://accounts.google.com/gsi/client" async></script>
</body>
</html>